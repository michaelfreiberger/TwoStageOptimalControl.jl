<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Example 1 · TwoStageOptimalControl.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">TwoStageOptimalControl.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../Functions/MainFunction/">Main Functions</a></li><li><a class="tocitem" href="../../Functions/ParametersVariablesSettings/">Parameters, Variables, Settings</a></li><li><a class="tocitem" href="../../Functions/ResultsHandling/">Results analysis</a></li><li><a class="tocitem" href="../../Functions/AuxiliaryFunction/">Auxiliary functions</a></li><li><a class="tocitem" href="../../Functions/LineSearch/">LineSearch</a></li><li><a class="tocitem" href="../../Functions/ModelFunctions/">Model Functions</a></li><li><a class="tocitem" href="../../Functions/StateSolvers/">State Solvers</a></li><li class="is-active"><a class="tocitem" href>Example 1</a><ul class="internal"><li class="toplevel"><a class="tocitem" href="#Solution-in-Julia"><span>Solution in Julia</span></a></li><li><a class="tocitem" href="#MyPara"><span>MyPara</span></a></li><li><a class="tocitem" href="#Model-functions"><span>Model functions</span></a></li><li><a class="tocitem" href="#Solve-the-model"><span>Solve the model</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Example 1</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Example 1</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/michaelfreiberger/TwoStageOptimalControl.jl/blob/master/docs/src/Examples/Test1.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Capital-accumulation-problem"><a class="docs-heading-anchor" href="#Capital-accumulation-problem">Capital accumulation problem</a><a id="Capital-accumulation-problem-1"></a><a class="docs-heading-anchor-permalink" href="#Capital-accumulation-problem" title="Permalink"></a></h1><p>Consider the following capital accumulation problem, where a stochastic shock destroys are certain share of the production capital. The problem consists of the following variables:</p><ul><li>Production capital <span>$K_1(t)$</span> before the shock (first stage), <span>$K_2(t,s)$</span> after the shock at time <span>$s$</span> (second stage).</li><li>Investment in production capital in the first, <span>$I_1(t)$</span>, and second, <span>$I_2(t,s)$</span>, stage.</li><li>Consumption <span>$c_1(t)$</span> and <span>$c_2(t,s)$</span> in the first and second stage. Consumption is thereby the residual of production minus the cost for investment in production capital (which is assumed to be quadratic)</li></ul><p class="math-container">\[\begin{aligned}
c_1(t) &amp;= K_1(t)^{0.5} - I_1(t)^2 \\
c_2(t,s) &amp;= K_2(t,s)^{0.5} - I_2(t,s)^2
\end{aligned}\]</p><ul><li>The shock has an arrival rate of <span>$\eta$</span> with the time horizon being scaled down to <span>$T=1.0$</span>. At the point of the shock, we assume a share <span>$\gamma$</span> of production capital is being destroyed.</li></ul><p>The social planer now maximizes the aggregated consumption over the whole time horizon. The whole problem writes as follows:</p><p class="math-container">\[\begin{aligned}
\max_{I_1(t),I_2(t,s)} &amp;\int_0^T e^{\rho t}\cdot\left\{ Z_1(t)\cdot \Big[ K_1(t)^{0.5} - I_1(t)^2\Big] + Q(t) \right\} dt \\
s.t.\hspace{1cm} \dot{K_1}(t) &amp;= I_1(t) - \delta K_1(t) &amp;&amp;,\qquad K_1(0) = K_1^0 \\
\dot{Z_1}(t) &amp;= - \eta\cdot Z_1(t)                      &amp;&amp;,\qquad Z_1(0) = 1 \\
\dot{K_2}(t,s) &amp;= I_2(t,s) - \delta K_2(t,s)            &amp;&amp;,\qquad K_2(s,s) = (1-\gamma)\cdot K_1(s) \\
\dot{Z_2}(t,s) &amp;= 0                                     &amp;&amp;,\qquad Z_2(s,s) = \eta\cdot Z_1(s) \\
Q(t) &amp;= \int_0^t Z_2(t,s)\cdot \Big[ K_2(t,s)^{0.5} - I_2(t,s)^2\Big] ds
\end{aligned}\]</p><h1 id="Solution-in-Julia"><a class="docs-heading-anchor" href="#Solution-in-Julia">Solution in Julia</a><a id="Solution-in-Julia-1"></a><a class="docs-heading-anchor-permalink" href="#Solution-in-Julia" title="Permalink"></a></h1><p>To solve this problem with our Toolbox, we can use the main function <code>TwoStageOptimisation</code>.</p><pre><code class="language-julia-repl hljs">julia&gt; Results = TwoStageOptimisation(UserParameters = MyPara,
                                ObjectiveIntegrand = U, 
                                AggregationFunction = Q,
                                StateDynamic_1 = f1,
                                StateDynamic_2 = f2, 
                                Shock = g,
                                SalvageFunction_1=S1,
                                SalvageFunction_2=S2)</code></pre><p>But first we need to define the functions <code>U, Q, f1, f2, g, S1</code> and <code>S2</code> as well as the dictionary <code>MyPara</code>.</p><p>Let us start with the dictionary.</p><h2 id="MyPara"><a class="docs-heading-anchor" href="#MyPara">MyPara</a><a id="MyPara-1"></a><a class="docs-heading-anchor-permalink" href="#MyPara" title="Permalink"></a></h2><p>The dictionary <code>MyPara</code> contains all relevant parameters of the model. We can initialize an empty dictionary by</p><pre><code class="language-julia-repl hljs">julia&gt; MyPara = Dict()</code></pre><p><code>MyPara</code> contains information on</p><h4 id="Model-specific-parameters"><a class="docs-heading-anchor" href="#Model-specific-parameters">Model specific parameters</a><a id="Model-specific-parameters-1"></a><a class="docs-heading-anchor-permalink" href="#Model-specific-parameters" title="Permalink"></a></h4><p>like <span>$\rho$</span>, <span>$\eta$</span> and <span>$\gamma$</span> in this example;</p><pre><code class="language-julia-repl hljs">julia&gt; MyPara[&quot;T&quot;] = 1
julia&gt; MyPara[&quot;rho&quot;] = 0.05
julia&gt; MyPara[&quot;delta&quot;] = 0.1
julia&gt; MyPara[&quot;eta&quot;] = 0.5
julia&gt; MyPara[&quot;gamma&quot;] = 0.2</code></pre><h4 id="Model-dimensions-of-controls-and-states"><a class="docs-heading-anchor" href="#Model-dimensions-of-controls-and-states">Model dimensions of controls and states</a><a id="Model-dimensions-of-controls-and-states-1"></a><a class="docs-heading-anchor-permalink" href="#Model-dimensions-of-controls-and-states" title="Permalink"></a></h4><p><code>nCon</code> is the number of control variables in the first stage, <code>nCon_dist</code> is the number of control variables in the second stage. <code>nStat</code> and <code>nStat_dist</code> are the dimensions of state variables before and after the shock.</p><pre><code class="language-julia-repl hljs">julia&gt; MyPara[&quot;nCon&quot;] = 1
julia&gt; MyPara[&quot;nCon_dist&quot;] = 1
julia&gt; MyPara[&quot;nStat&quot;] = 2
julia&gt; MyPara[&quot;nStat_dist&quot;] = 2</code></pre><h4 id="Control-boundaries-and-initial-state-values"><a class="docs-heading-anchor" href="#Control-boundaries-and-initial-state-values">Control boundaries and initial state values</a><a id="Control-boundaries-and-initial-state-values-1"></a><a class="docs-heading-anchor-permalink" href="#Control-boundaries-and-initial-state-values" title="Permalink"></a></h4><pre><code class="language-julia-repl hljs">julia&gt; MyPara[&quot;ConMin&quot;] = [0.0]
julia&gt; MyPara[&quot;Con_distMin&quot;] = [0.0]
julia&gt; MyPara[&quot;InitStat&quot;] = [0.1,1.0]</code></pre><h4 id="Algorithm-specifying-parameters"><a class="docs-heading-anchor" href="#Algorithm-specifying-parameters">Algorithm specifying parameters</a><a id="Algorithm-specifying-parameters-1"></a><a class="docs-heading-anchor-permalink" href="#Algorithm-specifying-parameters" title="Permalink"></a></h4><pre><code class="language-julia-repl hljs">julia&gt; MyPara[&quot;hstep&quot;] = 0.05
julia&gt; MyPara[&quot;InitLineStep&quot;] = 1e-5
julia&gt; MyPara[&quot;UpperLineStep&quot;] = 1e-1
julia&gt; MyPara[&quot;hLowBound&quot;] = 0.01
julia&gt; MyPara[&quot;PlotResultsIntermediateFrequency&quot;] = 30</code></pre><p>Information on the parameters base values, which are used if not specified differently, can be found in the section <a href="../../Functions/ParametersVariablesSettings/">Parameters, Variables, Settings</a></p><h2 id="Model-functions"><a class="docs-heading-anchor" href="#Model-functions">Model functions</a><a id="Model-functions-1"></a><a class="docs-heading-anchor-permalink" href="#Model-functions" title="Permalink"></a></h2><p>Now we need to specify all the functions used in the model. Any function, that is not defined is assumed to be the zero-function.</p><ul><li><code>U(Con, Stat, t::Float64, Para::Dict)</code> covers the utility function in the first stage (without the aggregated part <span>$Q(t)$</span> of the second stage). In our example this is </li></ul><pre><code class="language-julia-repl hljs">julia&gt; U(Con, Stat, t::Float64, Para::Dict) = Stat[2]*(Stat[1]^0.5 - Con[1]^2)</code></pre><ul><li><code>Q(Con,Stat, t::Float64,s::Float64, Para::Dict)</code> contains the function which is integrated to obtain the second stage utiltiy.</li></ul><pre><code class="language-julia-repl hljs">julia&gt; Q(Con,Stat, t::Float64,s::Float64, Para::Dict) = Stat[2]*(Stat[1]^0.5 - Con[1]^2)</code></pre><ul><li><code>f1(Con,Stat, t::Float64, Para::Dict)</code> and <code>f2(Con,Stat, t::Float64, s::Float64, Para::Dict)</code> are the function of the right hand side of the state dynamics.</li></ul><pre><code class="language-julia-repl hljs">julia&gt; f1(Con,Stat, t::Float64, Para::Dict) = [Con[1] - Para[&quot;delta&quot;]*Stat[1],-Para[&quot;eta&quot;]*Stat[2]]
julia&gt; f2(Con,Stat, t::Float64, s::Float64, Para::Dict) = [Con[1] - Para[&quot;delta&quot;]*Stat[1], 0]</code></pre><ul><li><code>g(Con,Stat,t::Float64, Para::Dict)</code> describes the transition function between the state variables in the two stages.</li></ul><pre><code class="language-julia-repl hljs">julia&gt; g(Con,Stat,t::Float64, Para::Dict) = [(1-Para[&quot;gamma&quot;])*Stat[1],Para[&quot;eta&quot;]*Stat[2]]</code></pre><ul><li><code>S1(Stat, Para::Dict)</code> and <code>S2(Stat_dist, Para::Dict)</code> are the salvage-function in the first and second stage. Since we have no salvage value in our toy-example, we could omit them as entries in <code>TwoStageOptimisation</code>. However, we can also specifiy and enter them.</li></ul><pre><code class="language-julia-repl hljs">julia&gt; S1(Stat, Para::Dict) = 0
julia&gt; S2(Stat_dist, Para::Dict) = 0</code></pre><h2 id="Solve-the-model"><a class="docs-heading-anchor" href="#Solve-the-model">Solve the model</a><a id="Solve-the-model-1"></a><a class="docs-heading-anchor-permalink" href="#Solve-the-model" title="Permalink"></a></h2><p>Finally we can solve the model. But first, we specify, that we want to give the initial guess for the control profiles to the algorithm</p><pre><code class="language-julia-repl hljs">julia&gt; MyPara[&quot;LoadInits&quot;] = true</code></pre><p>Now we define the profiles. We can pick the dimensions across time how big we like, the controls get interpolated in the solution process. Here we decided for 100 points. We define the control profiles as entries in the <code>Results</code> dictionary.</p><pre><code class="language-julia-repl hljs">julia&gt; Results = Dict()
julia&gt; Results[&quot;Con&quot;] = 4.0*ones(1,100,1)
julia&gt; Results[&quot;Con_dist&quot;] = 4.0*ones(100,100,1)
julia&gt; Results = TwoStageOptimisation(Results = Results,UserParameters = MyPara,
                                ObjectiveIntegrand1 = U, 
                                AggregationIntegrand2 = Q,
                                StateDynamic1 = f1,
                                StateDynamic2 = f2, 
                                Shock12 = g,
                                SalvageFunction1=S1,
                                SalvageFunction2=S2)</code></pre><p>Finally we can save the results in location of choice and also plot the final results. We have the option to save the plots, and they are automatically save</p><pre><code class="language-julia-repl hljs">julia&gt; SaveResults(Results,&quot;CapitalAccumulation&quot;)
julia&gt; PlotResults(Results,SavePlot = true)</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../Functions/StateSolvers/">« State Solvers</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Friday 6 October 2023 14:09">Friday 6 October 2023</span>. Using Julia version 1.6.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
